<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>json2apex - the best JSON 2 apex tool</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="json2apex is the best tool to convert JSON to Apex classes for Salesforce, including test classes. Fast, reliable, and user-friendly.">
    <meta name="keywords" content="json2apex, JSON to Apex, Salesforce Apex, Apex class generator, JSON parser, Salesforce development, Apex test class">
    <meta name="author" content="json2apex Team">
    <meta name="robots" content="index, follow">
    <!-- Material Design Components CSS -->
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Prism.js CSS for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <!-- Prism.js Line Numbers CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            background-color: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            max-width: 1200px;
            width: 100%;
            margin: 16px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .banner {
            font-size: 2.5rem;
            font-weight: bold;
            color: #6200ee;
            font-family: 'Roboto', sans-serif;
            text-align: left;
        }
        .mdc-text-field {
            width: 100%;
            margin-bottom: 16px;
        }
        .mdc-text-field--outlined {
            padding-top: 8px; /* Prevent label overlap */
        }
        .mdc-text-field--outlined .mdc-floating-label {
            top: 18px; /* Adjust label position */
            transform: translateY(-50%) scale(1);
        }
        .mdc-text-field--outlined.mdc-text-field--focused .mdc-floating-label,
        .mdc-text-field--outlined .mdc-text-field__input:not(:placeholder-shown) + .mdc-floating-label {
            transform: translateY(-100%) scale(0.75);
            top: 0;
        }
        .mdc-text-field--textarea .mdc-text-field__input {
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #6200ee;
        }
        .mdc-text-field--outlined .mdc-text-field__input {
            border-radius: 20px;
            padding: 16px;
        }
        .text-area-container {
            margin-bottom: 16px;
            position: relative; /* For positioning copy buttons */
        }
        .button-container {
            margin-bottom: 16px;
        }
        .mdc-button {
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .output-pre {
            background-color: #212121;
            color: white;
            padding: 16px;
            border-radius: 20px;
            border: 1px solid #6200ee;
            max-height: 400px;
            overflow: auto;
            font-family: 'Roboto Mono', monospace;
            position: relative; /* For positioning copy button */
        }
        .error-message {
            color: #d32f2f;
            margin-bottom: 16px;
            display: none;
        }
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 8px;
            background-color: #6200ee;
            color: #ffffff !important; /* Ensure text is white */
            z-index: 2; /* Above Prism.js content and line numbers */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .copy-button.copied-feedback {
            background-color: #4caf50 !important; /* Green flash for feedback */
        }
        .copy-button .mdc-button__label {
            font-size: 14px;
            color: #ffffff !important; /* Explicitly set text color */
        }
        .copy-tooltip {
            position: absolute;
            top: 36px; /* Below the button */
            right: 8px;
            background-color: #333;
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .copy-tooltip.show {
            opacity: 1;
        }
        /* Ensure Prism.js doesn't override copy button positioning */
        .output-pre code {
            display: block;
            padding: 0;
            background: none;
            border: none;
        }
        /* Line numbers styling */
        .line-numbers .line-numbers-rows {
            border-right: 1px solid #6200ee;
        }
        .intro-text {
            font-size: 1.1rem;
            margin-bottom: 24px;
            line-height: 1.5;
            color: #333;
            margin-left: 16px; /* Add space on left side */
        }
        .class-name-field {
            margin-bottom: 24px; /* Add space on bottom of class name */
        }
        .class-name-label {
            display: block;
            font-size: 1rem;
            color: #333;
            margin-bottom: 8px;
        }
        .class-name-input {
            width: 100%;
            border-radius: 20px;
            padding: 16px;
            border: 1px solid #6200ee;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .class-name-input:focus {
            outline: none;
            border-color: #6200ee;
            box-shadow: 0 0 0 2px rgba(98, 0, 238, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="banner">JSON2Apex</div>
        </div>
        <div class="intro-text">
            <p>JSON2Apex is the ultimate online tool for Salesforce developers to convert JSON to Apex classes effortlessly. Generate Apex wrapper classes and test classes from your JSON data. Supports complex nested objects and arrays. Perfect for handling complex nested objects and arrays.</p>
            <p>Three easy ways to input JSON:</p>
            <ul>
                <li>Upload from your local machine</li>
                <li>Copy and paste into the box</li>
                <li>Type it manually</li>
            </ul>
        </div>
        <div class="class-name-field">
            <label class="class-name-label" for="className">Apex Class Name</label>
            <input id="className" type="text" class="class-name-input" value="WrapperClass" aria-label="Apex Class Name">
        </div>
        <div class="text-area-container">
            <label class="mdc-typography--subtitle1" for="jsonInput">JSON Input</label>
            <button class="mdc-button mdc-button--outlined" onclick="document.getElementById('jsonFileUpload').click();" aria-label="Upload JSON File">
                <span class="mdc-button__label">Upload JSON File</span>
            </button>
            <input type="file" id="jsonFileUpload" accept=".json" style="display: none;" aria-label="JSON File Upload">
            <div class="mdc-text-field mdc-text-field--textarea">
                <textarea id="jsonInput" class="mdc-text-field__input" rows="15" aria-label="JSON Input">{"name": "John", "age": 30, "isActive": true, "details": {"city": "New York", "zip": 10001}, "hobbies": ["reading", "gaming"], "contacts": [{"name": "Alice", "phone": "123-456-7890"}]}</textarea>
            </div>
        </div>
        <div class="button-container">
            <button class="mdc-button mdc-button--raised" onclick="generateApexClass()" aria-label="Generate Apex Class">
                <span class="mdc-button__label">Generate Class</span>
            </button>
            <button class="mdc-button mdc-button--outlined" onclick="clearInput()" aria-label="Clear Input">
                <span class="mdc-button__label">Clear Input</span>
            </button>
            <button class="mdc-button mdc-button--outlined" onclick="downloadClasses()" aria-label="Download Classes">
                <span class="mdc-button__label">Download Classes</span>
            </button>
        </div>
        <div class="text-area-container">
            <label class="mdc-typography--subtitle1">Generated Apex Class</label>
            <pre id="apexOutput" class="output-pre language-apex line-numbers"><code class="language-apex"></code>
                <button class="mdc-button copy-button" onclick="copyToClipboard(this, 'apexOutput')" aria-label="Copy Apex Class">
                    <span class="mdc-button__label">Copy</span>
                    <span class="copy-tooltip">Copied!</span>
                </button>
            </pre>
        </div>
        <div class="text-area-container">
            <label class="mdc-typography--subtitle1">Generated Test Class</label>
            <pre id="testOutput" class="output-pre language-apex line-numbers"><code class="language-apex"></code>
                <button class="mdc-button copy-button" onclick="copyToClipboard(this, 'testOutput')" aria-label="Copy Test Class">
                    <span class="mdc-button__label">Copy</span>
                    <span class="copy-tooltip">Copied!</span>
                </button>
            </pre>
        </div>
        <div id="errorMessage" class="error-message"></div>
    </div>

    <!-- Material Design Components JS -->
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-apex.min.js"></script>
    <!-- Prism.js Line Numbers Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script>
        // Initialize Material Design Components
        document.querySelectorAll('.mdc-text-field').forEach((textField) => {
            mdc.textField.MDCTextField.attachTo(textField);
        });
        document.querySelectorAll('.mdc-button').forEach((button) => {
            mdc.ripple.MDCRipple.attachTo(button);
        });

        // Function to show error message temporarily
        function showErrorMessage(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
            }, 3000);
        }

        // File Upload Handler
        document.getElementById('jsonFileUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    try {
                        JSON.parse(content); // Validate JSON
                        document.getElementById('jsonInput').value = content; // Replace textarea content
                        document.getElementById('errorMessage').style.display = 'none';
                    } catch (err) {
                        showErrorMessage('Invalid JSON file: ' + err.message);
                    }
                    // Reset file input to allow re-uploading the same file
                    document.getElementById('jsonFileUpload').value = '';
                };
                reader.readAsText(file);
            }
        });

        // Copy to Clipboard
        function copyToClipboard(button, elementId) {
            const codeElement = document.querySelector(`#${elementId} code`);
            if (!codeElement) {
                console.error('Code element not found for ' + elementId);
                showErrorMessage('Code element not found for ' + elementId);
                return;
            }
            const text = codeElement.innerText.trim(); // Use innerText to get visible text, trim to remove extra spaces
            if (!text) {
                showErrorMessage('No content to copy!');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                // Apply feedback styling
                button.classList.add('copied-feedback');
                const tooltip = button.querySelector('.copy-tooltip');
                tooltip.classList.add('show');
                setTimeout(() => {
                    button.classList.remove('copied-feedback');
                    tooltip.classList.remove('show');
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showErrorMessage('Failed to copy to clipboard! Please try again.');
            });
        }

        // Clear Input
        function clearInput() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('className').value = 'WrapperClass';
            document.querySelector('#apexOutput code').textContent = '';
            document.querySelector('#testOutput code').textContent = '';
            document.getElementById('errorMessage').style.display = 'none';
            document.querySelectorAll('.copy-button').forEach(button => {
                button.classList.remove('copied-feedback');
                button.querySelector('.copy-tooltip').classList.remove('show');
            });
            Prism.highlightAll();
        }

        // Download Classes
        function downloadClasses() {
            const className = document.getElementById('className').value.trim() || 'WrapperClass';
            const apexContent = document.querySelector('#apexOutput code').textContent;
            const testContent = document.querySelector('#testOutput code').textContent;

            if (!apexContent || !testContent) {
                showErrorMessage('Please generate the classes first!');
                return;
            }

            const zip = new JSZip();
            zip.file(`${className}.cls`, apexContent);
            zip.file(`${className}Test.cls`, testContent);

            zip.generateAsync({ type: 'blob' }).then(content => {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'json2apex.zip';
                link.click();
            });
        }

        function generateApexClass() {
            const jsonInput = document.getElementById('jsonInput').value;
            const className = document.getElementById('className').value.trim() || 'WrapperClass';
            const errorMessage = document.getElementById('errorMessage');
            const apexOutput = document.querySelector('#apexOutput code');
            const testOutput = document.querySelector('#testOutput code');

            // Reset error and output
            errorMessage.style.display = 'none';
            errorMessage.textContent = '';
            apexOutput.textContent = '';
            testOutput.textContent = '';
            document.querySelectorAll('.copy-button').forEach(button => {
                button.classList.remove('copied-feedback');
                button.querySelector('.copy-tooltip').classList.remove('show');
            });

            try {
                // Parse JSON
                const jsonObj = JSON.parse(jsonInput);

                // Generate Apex class
                let apexClass = `public class ${className} {\n`;
                const properties = [];
                const nestedClasses = [];

                // Function to sanitize variable names (improved to handle dots and special chars)
                function sanitizeName(name) {
                    // Replace dots, special chars, and spaces with underscores; ensure valid Apex identifier
                    return name.replace(/[^a-zA-Z0-9]/g, '_').replace(/^(\d)/, '_$1');
                }

                // Function to map JSON types to Apex types
                function getApexType(value, parentKey = '') {
                    if (value === null) return 'Object';
                    if (typeof value === 'string') return 'String';
                    if (typeof value === 'number') {
                        return Number.isInteger(value) ? 'Integer' : 'Decimal';
                    }
                    if (typeof value === 'boolean') return 'Boolean';
                    if (Array.isArray(value)) {
                        if (value.length === 0) return 'List<Object>';
                        const firstNonNull = value.find(v => v !== null) || value[0];
                        if (firstNonNull === undefined) return 'List<Object>';
                        const elementType = getApexType(firstNonNull, parentKey);
                        return `List<${elementType}>`;
                    }
                    if (typeof value === 'object') {
                        if (Object.keys(value).length === 0) return 'Map<String, Object>';
                        const nestedClassName = `Inner_${sanitizeName(parentKey)}_${nestedClasses.length}`;
                        nestedClasses.push(generateNestedClass(nestedClassName, value));
                        return nestedClassName;
                    }
                    return 'Object';
                }

                // Function to generate nested classes with explicit parse methods
                function generateNestedClass(nestedClassName, obj) {
                    let nestedClass = `\n    public class ${nestedClassName} {\n`;
                    const nestedProperties = [];
                    for (const [key, val] of Object.entries(obj)) {
                        const apexType = getApexType(val, key);
                        nestedProperties.push(`        public ${apexType} ${sanitizeName(key)};`);
                    }
                    nestedClass += nestedProperties.join('\n') + '\n';
                    // Always include explicit parse method
                    nestedClass += `        public static ${nestedClassName} parse(String json) {\n`;
                    nestedClass += `            return (${nestedClassName}) System.JSON.deserialize(json, ${nestedClassName}.class);\n`;
                    nestedClass += `        }\n`;
                    nestedClass += '    }\n';
                    return nestedClass;
                }

                // Generate properties for the main class
                for (const [key, value] of Object.entries(jsonObj)) {
                    const apexType = getApexType(value, key);
                    properties.push(`    public ${apexType} ${sanitizeName(key)};`);
                }

                apexClass += properties.join('\n') + '\n';
                apexClass += nestedClasses.join('');
                // Always include explicit parse method for main class
                apexClass += `    public static ${className} parse(String json) {\n`;
                apexClass += `        return (${className}) System.JSON.deserialize(json, ${className}.class);\n`;
                apexClass += `    }\n`;
                apexClass += '}';

                // Generate Test Class
                let testClass = `@isTest\nprivate class ${className}Test {\n`;
                testClass += `    @isTest\n    static void test${className}() {\n`;
                testClass += `        String jsonString = '${jsonInput.replace(/'/g, "\\'").replace(/\n/g, '\\n')}';\n`;
                testClass += `        ${className} wrapper = ${className}.parse(jsonString);\n`;
                testClass += `        System.assertNotEquals(null, wrapper, 'Parsed wrapper should not be null');\n`;
                for (const [key, value] of Object.entries(jsonObj)) {
                    const sanitizedKey = sanitizeName(key);
                    if (typeof value !== 'object' && !Array.isArray(value) && value !== null) {
                        testClass += `        System.assertEquals(${JSON.stringify(value)}, wrapper.${sanitizedKey}, 'Value for ${sanitizedKey} should match');\n`;
                    } else if (Array.isArray(value)) {
                        testClass += `        System.assertEquals(${value.length}, wrapper.${sanitizedKey} != null ? wrapper.${sanitizedKey}.size() : 0, 'List size for ${sanitizedKey} should match');\n`;
                    } else if (typeof value === 'object' && value !== null) {
                        testClass += `        System.assertNotEquals(null, wrapper.${sanitizedKey}, '${sanitizedKey} should not be null');\n`;
                    }
                }
                testClass += `    }\n`;
                testClass += `    @isTest\n    static void testParse() {\n`;
                testClass += `        String jsonString = '${jsonInput.replace(/'/g, "\\'").replace(/\n/g, '\\n')}';\n`;
                testClass += `        ${className} wrapper = ${className}.parse(jsonString);\n`;
                testClass += `        System.assertNotEquals(null, wrapper, 'Parsed wrapper should not be null');\n`;
                testClass += `    }\n`;
                testClass += '}\n';

                // Display the generated classes
                apexOutput.textContent = apexClass;
                testOutput.textContent = testClass;
                Prism.highlightAll();
            } catch (e) {
                showErrorMessage('Invalid JSON: ' + e.message);
            }
        }
    </script>
    <!-- JSZip for creating ZIP file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</body>
</html>
